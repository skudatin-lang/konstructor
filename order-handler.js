// === –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram ===
const TELEGRAM_BOT_TOKEN = '7995086363:AAHAonpRf69e1avVPq9_rJqToTsuPRSxnf4';
const TELEGRAM_CHANNEL_ID = '-1003314026322';

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏
let appState = null;
let appCategoriesConfig = null;
let appModelsConfig = null;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è
function initOrderHandler(stateRef, categoriesRef, modelsRef) {
    appState = stateRef;
    appCategoriesConfig = categoriesRef;
    appModelsConfig = modelsRef;
}

// –í–Ω–µ—à–Ω—è—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
function submitOrder(name, contact, comment, agree, selectedModel, uploadedPhotos) {
    if (!agree) {
        showNotification('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö', true);
        return;
    }
    if (!name || !contact) {
        showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é', true);
        return;
    }
    if (!selectedModel) {
        showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å', true);
        return;
    }
    if (uploadedPhotos.length === 0) {
        showNotification('–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Ñ–æ—Ç–æ', true);
        return;
    }

    appState.customerName = name;
    appState.customerContact = contact;
    appState.comment = comment;
    appState.uploadedPhotos = uploadedPhotos;

    const btn = document.getElementById('submitOrder');
    const orig = btn.innerHTML;
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ...';

    submitOrderInternal()
        .then(() => {
            showNotification('–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω! –î–æ–≥–æ–≤–æ—Ä —Å–æ–∑–¥–∞–Ω.');
        })
        .catch(e => {
            console.error(e);
            showNotification('–û—à–∏–±–∫–∞, –Ω–æ –¥–æ–≥–æ–≤–æ—Ä –≤—Å—ë —Ä–∞–≤–Ω–æ —Å–æ–∑–¥–∞–Ω.', true);
            generateDetailedContract();
        })
        .finally(() => {
            btn.disabled = false;
            btn.innerHTML = orig;
        });
}

async function submitOrderInternal() {
    await sendOrderToTelegram();
    await sendContractToTelegram();
    generateDetailedContract();
}

// === –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ===
function showNotification(message, isError = false, isWarning = false) {
    const notification = document.createElement('div');
    notification.className = `notification ${isError ? 'error' : isWarning ? 'warning' : ''}`;
    notification.innerHTML = `<i class="fas fa-${isError ? 'exclamation-circle' : isWarning ? 'exclamation-triangle' : 'check-circle'}"></i> <span>${message}</span>`;
    document.body.appendChild(notification);
    setTimeout(() => notification.remove(), 5000);
}

function calculatePrice() {
    if (!appState.selectedCategory || !appState.selectedGender) return 0;
    const cat = appCategoriesConfig[appState.selectedGender].find(c => c.id === appState.selectedCategory);
    if (!cat || typeof cat.basePrice !== 'number') return 0;
    let base = cat.basePrice;
    if (appState.projectType === 'ready' && !cat.noDiscount) base = Math.round(base * 0.5);
    let total = base;
    if (['15', '18'].includes(appState.height)) total = Math.round(total * 1.15);
    else if (['20', '25'].includes(appState.height)) total = Math.round(total * 1.25);
    if (appState.baseDays === '7') total = Math.round(total * 1.1);
    else if (appState.baseDays === '3') total = Math.round(total * 1.2);
    if (appState.exclusive) total = Math.round(total * 1.6);
    let pc = 0, pc2 = 0;
    if (appState.printing) {
        pc = appState.height === '10' ? 2500 : (['15','18'].includes(appState.height) ? 4000 : 5500);
    }
    if (appState.painting) {
        pc2 = appState.height === '10' ? 7000 : (['15','18'].includes(appState.height) ? 10000 : 12000);
    }
    return total + pc + pc2;
}

function calculateFinalDays() {
    let days = parseInt(appState.baseDays) || 14;
    if (appState.printing) days += 14;
    if (appState.painting) days += 14;
    return days;
}

function getAvailableModels() {
    if (!appState.selectedCategory || !appState.selectedGender) return [];
    return appModelsConfig[appState.selectedCategory]?.[appState.selectedGender] || [];
}

// === Telegram –∏ –¥–æ–≥–æ–≤–æ—Ä ===
async function sendOrderToTelegram() {
    const price = calculatePrice();
    const finalDays = calculateFinalDays();
    const category = appCategoriesConfig[appState.selectedGender]?.find(cat => cat.id === appState.selectedCategory);
    let modelName = '';
    if (appState.projectType === 'individual') {
        modelName = '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å';
    } else {
        const model = getAvailableModels().find(m => m.id === appState.selectedModel);
        modelName = model?.name || '–ú–æ–¥–µ–ª—å –Ω–µ –≤—ã–±—Ä–∞–Ω–∞';
    }
    const telegramMessage = `
üéØ   *–ù–û–í–´–ô –ó–ê–ö–ê–ó 3D-–ú–û–î–ï–õ–ò*
üë§   *–ö–ª–∏–µ–Ω—Ç:* ${appState.customerName}
üìû   *–ö–æ–Ω—Ç–∞–∫—Ç—ã:* ${appState.customerContact}
üìã   *–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞:*
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚îú  –¢–∏–ø: ${appState.projectType === 'individual' ? '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ü–µ–Ω–∞)' : '–ì–æ—Ç–æ–≤–∞—è –º–æ–¥–µ–ª—å (—Å–∫–∏–¥–∫–∞ 50%)'}
‚îú  –ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${category?.name}
‚îú  –ú–æ–¥–µ–ª—å: ${modelName}
‚îú  –ü–æ–ª: ${appState.selectedGender === 'male' ? '–ú—É–∂—Å–∫–æ–π' : '–ñ–µ–Ω—Å–∫–∏–π'}
‚îú  –í—ã—Å–æ—Ç–∞: ${appState.height} —Å–º
‚îú  –°—Ä–æ–∫: ${finalDays} –¥–Ω–µ–π
‚îú  –≠–∫—Å–∫–ª—é–∑–∏–≤: ${appState.exclusive ? '‚úÖ –î–ê (+60%)' : '‚ùå –ù–ï–¢'}
‚îú  –ü–µ—á–∞—Ç—å: ${appState.printing ? '‚úÖ –î–ê' : '‚ùå –ù–ï–¢'}
‚îú  –ü–æ–∫—Ä–∞—Å–∫–∞: ${appState.painting ? '‚úÖ –î–ê' : '‚ùå –ù–ï–¢'}
‚îú  –§–æ—Ç–æ: ${appState.uploadedPhotos.length} —à—Ç.
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üí∞   *–°—Ç–æ–∏–º–æ—Å—Ç—å:* ${price.toLocaleString()} —Ä—É–±.
üí¨   *–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:* ${appState.comment || '–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è'}
üÜî   *ID –∑–∞–∫–∞–∑–∞:* ${Date.now().toString().slice(-8)}
    `.trim();
    try {
        const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ chat_id: TELEGRAM_CHANNEL_ID, text: telegramMessage, parse_mode: 'Markdown' })
        });
        if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏');

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–µ—Ä–≤–æ–µ —Ñ–æ—Ç–æ –∫–∞–∫ –ø—Ä–µ–≤—å—é
        if (appState.uploadedPhotos.length > 0) {
            const photoBlob = await fetch(appState.uploadedPhotos[0]).then(r => r.blob());
            const formData = new FormData();
            formData.append('chat_id', TELEGRAM_CHANNEL_ID);
            formData.append('photo', photoBlob, 'customer_photo.jpg');
            formData.append('caption', `üì∏ –§–æ—Ç–æ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞: ${appState.customerName} (${appState.uploadedPhotos.length} —à—Ç.)`);
            await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendPhoto`, { method: 'POST', body: formData });
        }
    } catch (e) {
        console.error('–û—à–∏–±–∫–∞ Telegram:', e);
        throw e;
    }
}

async function sendContractToTelegram() {
    const contractText = generateContractText();
    const formData = new FormData();
    formData.append('chat_id', TELEGRAM_CHANNEL_ID);
    formData.append('document', new Blob([contractText], { type: 'text/plain' }), `–î–æ–≥–æ–≤–æ—Ä_${appState.customerName}_${Date.now().toString().slice(-6)}.txt`);
    formData.append('caption', `üìÑ –î–û–ì–û–í–û–† –û–¢ –ö–õ–ò–ï–ù–¢–ê\nüë§ ${appState.customerName}\nüìû ${appState.customerContact}\nüí∞ ${calculatePrice().toLocaleString()} —Ä—É–±.`);
    await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendDocument`, { method: 'POST', body: formData });
}

// === –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞ (–æ—Å—Ç–∞–ª–∞—Å—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ===
function getMonthName(month) {
    const months = ['—è–Ω–≤–∞—Ä—è','—Ñ–µ–≤—Ä–∞–ª—è','–º–∞—Ä—Ç–∞','–∞–ø—Ä–µ–ª—è','–º–∞—è','–∏—é–Ω—è','–∏—é–ª—è','–∞–≤–≥—É—Å—Ç–∞','—Å–µ–Ω—Ç—è–±—Ä—è','–æ–∫—Ç—è–±—Ä—è','–Ω–æ—è–±—Ä—è','–¥–µ–∫–∞–±—Ä—è'];
    return months[month];
}

function numberToWords(number) {
    const units = ['', '–æ–¥–∏–Ω','–¥–≤–∞','—Ç—Ä–∏','—á–µ—Ç—ã—Ä–µ','–ø—è—Ç—å','—à–µ—Å—Ç—å','—Å–µ–º—å','–≤–æ—Å–µ–º—å','–¥–µ–≤—è—Ç—å'];
    const teens = ['–¥–µ—Å—è—Ç—å','–æ–¥–∏–Ω–Ω–∞–¥—Ü–∞—Ç—å','–¥–≤–µ–Ω–∞–¥—Ü–∞—Ç—å','—Ç—Ä–∏–Ω–∞–¥—Ü–∞—Ç—å','—á–µ—Ç—ã—Ä–Ω–∞–¥—Ü–∞—Ç—å','–ø—è—Ç–Ω–∞–¥—Ü–∞—Ç—å','—à–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç—å','—Å–µ–º–Ω–∞–¥—Ü–∞—Ç—å','–≤–æ—Å–µ–º–Ω–∞–¥—Ü–∞—Ç—å','–¥–µ–≤—è—Ç–Ω–∞–¥—Ü–∞—Ç—å'];
    const tens = ['','','–¥–≤–∞–¥—Ü–∞—Ç—å','—Ç—Ä–∏–¥—Ü–∞—Ç—å','—Å–æ—Ä–æ–∫','–ø—è—Ç—å–¥–µ—Å—è—Ç','—à–µ—Å—Ç—å–¥–µ—Å—è—Ç','—Å–µ–º—å–¥–µ—Å—è—Ç','–≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç','–¥–µ–≤—è–Ω–æ—Å—Ç–æ'];
    const hundreds = ['','—Å—Ç–æ','–¥–≤–µ—Å—Ç–∏','—Ç—Ä–∏—Å—Ç–∞','—á–µ—Ç—ã—Ä–µ—Å—Ç–∞','–ø—è—Ç—å—Å–æ—Ç','—à–µ—Å—Ç—å—Å–æ—Ç','—Å–µ–º—å—Å–æ—Ç','–≤–æ—Å–µ–º—å—Å–æ—Ç','–¥–µ–≤—è—Ç—å—Å–æ—Ç'];
    let num = parseInt(number);
    if (isNaN(num) || num <= 0) return '–Ω–æ–ª—å';
    let result = '';
    if (num >= 1000) {
        const thousands = Math.floor(num / 1000);
        if (thousands === 1) result += '–æ–¥–Ω–∞ —Ç—ã—Å—è—á–∞ ';
        else if (thousands >= 2 && thousands <= 4) result += numberToWords(thousands) + ' —Ç—ã—Å—è—á–∏ ';
        else result += numberToWords(thousands) + ' —Ç—ã—Å—è—á ';
        num %= 1000;
    }
    if (num >= 100) {
        result += hundreds[Math.floor(num / 100)] + ' ';
        num %= 100;
    }
    if (num >= 20) {
        result += tens[Math.floor(num / 10)] + ' ';
        num %= 10;
    } else if (num >= 10) {
        result += teens[num - 10] + ' ';
        num = 0;
    }
    if (num > 0) result += units[num] + ' ';
    return result.trim();
}

function generateContractText() {
    const price = calculatePrice();
    const now = new Date();
    const day = now.getDate();
    const month = getMonthName(now.getMonth());
    const year = now.getFullYear();
    const baseDays = parseInt(appState.baseDays) || 14;
    const stage2Duration = Math.max(2, Math.ceil(baseDays * 0.4));
    const stage3Duration = Math.max(3, Math.ceil(baseDays * 0.6));
    const category = appCategoriesConfig[appState.selectedGender]?.find(cat => cat.id === appState.selectedCategory);
    let modelName = '';
    let projectName = '';
    if (appState.projectType === 'individual') {
        modelName = '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å';
        projectName = `–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è 3D –º–æ–¥–µ–ª—å: ${appState.selectedGender === 'male' ? '–ú—É–∂—Å–∫–∞—è' : '–ñ–µ–Ω—Å–∫–∞—è'} ${category?.name || ''}`;
    } else {
        const model = getAvailableModels().find(m => m.id === appState.selectedModel);
        modelName = model?.name || '–ú–æ–¥–µ–ª—å –Ω–µ –≤—ã–±—Ä–∞–Ω–∞';
        projectName = `3D –º–æ–¥–µ–ª—å –ø–æ —Ñ–æ—Ç–æ: ${modelName}`;
    }
    let printingCost = 0, paintingCost = 0;
    if (appState.printing) printingCost = appState.height === '10' ? 2500 : (['15','18'].includes(appState.height) ? 4000 : 5500);
    if (appState.painting) paintingCost = appState.height === '10' ? 7000 : (['15','18'].includes(appState.height) ? 10000 : 12000);
    const stage1Cost = Math.round(price * 0.2);
    const stage2Cost = Math.round(price * 0.3);
    const stage3Cost = price - stage1Cost - stage2Cost;
    let contractText = `
–î–û–ì–û–í–û–†-–û–§–ï–†–¢–ê
–Ω–∞ –æ–∫–∞–∑–∞–Ω–∏–µ —É—Å–ª—É–≥ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é 3D-–º–æ–¥–µ–ª–∏
–≥. –ú–æ—Å–∫–≤–∞ ¬´${day}¬ª ${month} ${year} –≥.
–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å: –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω –°–µ—Ä–≥–µ–µ–≤–∏—á –°., –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∑–∞–∫–ª—é—á–∏—Ç—å –Ω–∞—Å—Ç–æ—è—â–∏–π –î–æ–≥–æ–≤–æ—Ä –ª—é–±–æ–º—É –ª–∏—Ü—É (–¥–∞–ª–µ–µ ‚Äî ¬´–ó–∞–∫–∞–∑—á–∏–∫¬ª).
1. –ü–†–ï–î–ú–ï–¢ –î–û–ì–û–í–û–†–ê
1.1. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –æ–±—è–∑—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å 3D-–º–æ–¥–µ–ª—å –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º –∑–∞–¥–∞–Ω–∏–µ–º (–¢–ó), —è–≤–ª—è—é—â–∏–º—Å—è –Ω–µ–æ—Ç—ä–µ–º–ª–µ–º–æ–π —á–∞—Å—Ç—å—é –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –î–æ–≥–æ–≤–æ—Ä–∞, –∞ –ó–∞–∫–∞–∑—á–∏–∫ –æ–±—è–∑—É–µ—Ç—Å—è –ø—Ä–∏–Ω—è—Ç—å –∏ –æ–ø–ª–∞—Ç–∏—Ç—å —Ä–∞–±–æ—Ç—É.
1.2. 3D-–º–æ–¥–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è –∞–¥–∞–ø—Ç–∞—Ü–∏–µ–π 2D-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ 3D-–æ–±—ä–µ–∫—Ç –∏ –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –≤ —Å–∏–ª—É —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π —Ç–∞–∫–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞.
${appState.projectType === 'individual' ? `
1.3. –ü—Ä–∏ –≤—ã–±–æ—Ä–µ —É—Å–ª—É–≥–∏ ¬´–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å –ø–æ —Ñ–æ—Ç–æ¬ª –ó–∞–∫–∞–∑—á–∏–∫ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Å–ª–µ–¥—É—é—â–∏–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º:
‚Äî —á—ë—Ç–∫–æ–µ, –±–µ–∑ —Ä–∞–∑–º—ã—Ç–∏—è –∏–ª–∏ —Å–∏–ª—å–Ω–æ–≥–æ —Å–∂–∞—Ç–∏—è;
‚Äî –ª–∏—Ü–æ –≤ 3/4, –±–µ–∑ —Å–∏–ª—å–Ω—ã—Ö —Ç–µ–Ω–µ–π, –±–ª–∏–∫–æ–≤ –∏–ª–∏ —è—Ä–∫–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–≤–æ–≥–æ —Å–≤–µ—Ç–∞;
‚Äî –≤ –∫–∞–¥—Ä–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —á–µ–ª–æ–≤–µ–∫.
–ï—Å–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º, –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –≤–ø—Ä–∞–≤–µ –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤ —Å –º–æ–º–µ–Ω—Ç–∞ –æ–ø–ª–∞—Ç—ã —Ä–∞—Å—Ç–æ—Ä–≥–Ω—É—Ç—å –î–æ–≥–æ–≤–æ—Ä –∏ –≤–µ—Ä–Ω—É—Ç—å –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—É –≤ –ø–æ–ª–Ω–æ–º –æ–±—ä—ë–º–µ –±–µ–∑ —É–¥–µ—Ä–∂–∞–Ω–∏–π.
` : `
1.3. –ü—Ä–∏ –≤—ã–±–æ—Ä–µ —É—Å–ª—É–≥–∏ ¬´–ì–æ—Ç–æ–≤–∞—è –º–æ–¥–µ–ª—å —Å –ª–∏—Ü–æ–º –ø–æ —Ñ–æ—Ç–æ¬ª –ó–∞–∫–∞–∑—á–∏–∫ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ª–∏—Ü–∞ –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –º–æ–¥–µ–ª—å.
`}
2. –°–¢–û–ò–ú–û–°–¢–¨ –ò –ü–û–†–Ø–î–û–ö –û–ü–õ–ê–¢–´
2.1. –¶–µ–Ω–∞ –î–æ–≥–æ–≤–æ—Ä–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç ${price} (${numberToWords(price.toString())}) —Ä—É–±–ª–µ–π.
${appState.projectType === 'individual' ? '2.2. –í—ã–±—Ä–∞–Ω–∞ —É—Å–ª—É–≥–∞ ¬´–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å –ø–æ —Ñ–æ—Ç–æ¬ª –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Ü–µ–Ω–µ.' : 
  category?.noDiscount ? '2.2. –í—ã–±—Ä–∞–Ω–∞ –±—é–¥–∂–µ—Ç–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è ¬´–ú–æ–¥–µ–ª–∏ –æ—Ç 990 ‚ÇΩ¬ª –±–µ–∑ —Å–∫–∏–¥–∫–∏.' : '2.2. –í—ã–±—Ä–∞–Ω–∞ —É—Å–ª—É–≥–∞ ¬´–ì–æ—Ç–æ–≤–∞—è –º–æ–¥–µ–ª—å —Å –ª–∏—Ü–æ–º –ø–æ —Ñ–æ—Ç–æ¬ª —Å–æ —Å–∫–∏–¥–∫–æ–π 50% –æ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Ü–µ–Ω—ã.'}
2.3. –û–ø–ª–∞—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –≤ —Ç—Ä–∏ —ç—Ç–∞–ø–∞:
‚Ä¢ –≠—Ç–∞–ø 1 (20%): ${stage1Cost} —Ä—É–±. ‚Äì –æ–ø–ª–∞—Ç–∞ –¥–æ –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç. –Ø–≤–ª—è–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –∞–∫—Ü–µ–ø—Ç–∞ –¥–∞–Ω–Ω–æ–π –æ—Ñ–µ—Ä—Ç—ã.
‚Ä¢ –≠—Ç–∞–ø 2 (30%): ${stage2Cost} —Ä—É–±. ‚Äì –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å –≠—Ç–∞–ø–æ–º 1.
‚Ä¢ –≠—Ç–∞–ø 3 (50%): ${stage3Cost} —Ä—É–±. ‚Äì –æ–ø–ª–∞—Ç–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 2 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π —Å –º–æ–º–µ–Ω—Ç–∞ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è 3D-—ç—Å–∫–∏–∑–∞.
2.4. –°—Ç–æ—Ä–æ–Ω—ã —Å–æ–≥–ª–∞—à–∞—é—Ç—Å—è, —á—Ç–æ –æ–ø–ª–∞—Ç–∞ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–Ω—è—Ç–æ–≥–æ —ç—Ç–∞–ø–∞ —è–≤–ª—è–µ—Ç—Å—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–µ–π —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø–æ–Ω–µ—Å–µ–Ω–Ω—ã—Ö –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º —Ä–∞—Å—Ö–æ–¥–æ–≤ –∏ –≤–æ–∑–≤—Ä–∞—Ç—É –Ω–µ –ø–æ–¥–ª–µ–∂–∏—Ç.
2.5. –†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã:
–¢-–±–∞–Ω–∫ –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω –°–µ—Ä–≥–µ–µ–≤–∏—á –°.
89777145325
2.6. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –æ–ø–ª–∞—Ç—ã —è–≤–ª—è–µ—Ç—Å—è —á–µ–∫, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –ó–∞–∫–∞–∑—á–∏–∫–æ–º –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é.
3. –≠–¢–ê–ü–´ –†–ê–ë–û–¢–´ –ò –ü–†–ò–ï–ú–ö–ò
3.1. –≠—Ç–∞–ø 1 (–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞): –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –¢–ó –∏ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–æ–≤. –°—á–∏—Ç–∞–µ—Ç—Å—è –ø—Ä–∏–Ω—è—Ç—ã–º –∏ –æ–ø–ª–∞—á–µ–Ω–Ω—ã–º —Å –º–æ–º–µ–Ω—Ç–∞ –æ–ø–ª–∞—Ç—ã –≠—Ç–∞–ø–æ–≤ 1 –∏ 2.
3.2. –≠—Ç–∞–ø 2 (3D-—ç—Å–∫–∏–∑):
‚Ä¢ –°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ${stage2Duration} —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è —Å –º–æ–º–µ–Ω—Ç–∞ –æ–ø–ª–∞—Ç—ã –≠—Ç–∞–ø–æ–≤ 1 –∏ 2.
‚Ä¢ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ó–∞–∫–∞–∑—á–∏–∫—É.
‚Ä¢ –ó–∞–∫–∞–∑—á–∏–∫ –æ–±—è–∑–∞–Ω –≤ —Ç–µ—á–µ–Ω–∏–µ 48 —á–∞—Å–æ–≤ –Ω–∞–ø—Ä–∞–≤–∏—Ç—å –º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –¢–ó –∏–ª–∏ —É—Ç–≤–µ—Ä–¥–∏—Ç—å —ç—Ç–∞–ø. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—Ç–≤–µ—Ç–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Å—Ä–æ–∫–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –±–µ–∑–æ–≥–æ–≤–æ—Ä–æ—á–Ω—ã–º –ø—Ä–∏–Ω—è—Ç–∏–µ–º —ç—Ç–∞–ø–∞.
3.3. –≠—Ç–∞–ø 3 (–§–∏–Ω–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å):
‚Ä¢ –°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ${stage3Duration} —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è —Å –º–æ–º–µ–Ω—Ç–∞ –æ–ø–ª–∞—Ç—ã –≠—Ç–∞–ø–∞ 3.
‚Ä¢ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ó–∞–∫–∞–∑—á–∏–∫—É.
‚Ä¢ –ó–∞–∫–∞–∑—á–∏–∫ –æ–±—è–∑–∞–Ω –≤ —Ç–µ—á–µ–Ω–∏–µ 48 —á–∞—Å–æ–≤ –Ω–∞–ø—Ä–∞–≤–∏—Ç—å –º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –¢–ó –∏–ª–∏ —É—Ç–≤–µ—Ä–¥–∏—Ç—å —ç—Ç–∞–ø. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—Ç–≤–µ—Ç–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Å—Ä–æ–∫–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –±–µ–∑–æ–≥–æ–≤–æ—Ä–æ—á–Ω—ã–º –ø—Ä–∏–Ω—è—Ç–∏–µ–º —ç—Ç–∞–ø–∞.
3.4. –í —Å–ª—É—á–∞–µ –Ω–µ–æ–ø–ª–∞—Ç—ã –≠—Ç–∞–ø–∞ 3 –≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å—Ä–æ–∫, –Ω–∞—Å—Ç–æ—è—â–∏–π –î–æ–≥–æ–≤–æ—Ä —Å—á–∏—Ç–∞–µ—Ç—Å—è —Ä–∞—Å—Ç–æ—Ä–≥–Ω—É—Ç—ã–º –ø–æ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–µ –ó–∞–∫–∞–∑—á–∏–∫–∞. –û–ø–ª–∞—Ç–∞ –∑–∞ –ø—Ä–∏–Ω—è—Ç—ã–µ –≠—Ç–∞–ø—ã 1 –∏ 2 –≤–æ–∑–≤—Ä–∞—Ç—É –Ω–µ –ø–æ–¥–ª–µ–∂–∏—Ç.
`;
    if (appState.printing || appState.painting) {
        contractText += `
4. –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –£–°–õ–£–ì–ò (–ê–ì–ï–ù–¢–ò–†–û–í–ê–ù–ò–ï)
4.1. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –¥–µ–π—Å—Ç–≤—É–µ—Ç –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ê–≥–µ–Ω—Ç–∞ –ó–∞–∫–∞–∑—á–∏–∫–∞ –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —É—Å–ª—É–≥ 3D-–ø–µ—á–∞—Ç–∏ –∏ –ø–æ–∫—Ä–∞—Å–∫–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏ —Å–∏–ª–∞–º–∏ —Ç—Ä–µ—Ç—å–∏—Ö –ª–∏—Ü (–ü–æ–¥—Ä—è–¥—á–∏–∫–æ–≤). –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã–º –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º –¥–∞–Ω–Ω—ã—Ö —É—Å–ª—É–≥.
4.2. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ó–∞–∫–∞–∑—á–∏–∫—É –¥–ª—è —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:
‚Ä¢ –ü–µ—Ä–µ—á–µ–Ω—å –ü–æ–¥—Ä—è–¥—á–∏–∫–æ–≤ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏—Ö —Ä–∞–±–æ—Ç
‚Ä¢ –°—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥ –∫–∞–∂–¥–æ–≥–æ –ü–æ–¥—Ä—è–¥—á–∏–∫–∞
‚Ä¢ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
4.3. –ü–æ—Å–ª–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ó–∞–∫–∞–∑—á–∏–∫–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ –ø. 4.2, –ó–∞–∫–∞–∑—á–∏–∫ –ø–æ—Ä—É—á–∞–µ—Ç –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é –∑–∞–∫–ª—é—á–∏—Ç—å –¥–æ–≥–æ–≤–æ—Ä—ã —Å –ü–æ–¥—Ä—è–¥—á–∏–∫–∞–º–∏ –æ—Ç –∏–º–µ–Ω–∏ –∏ –∑–∞ —Å—á–µ—Ç –ó–∞–∫–∞–∑—á–∏–∫–∞.
4.4. –ü–æ—Ä—è–¥–æ–∫ —Ä–∞—Å—á–µ—Ç–æ–≤ –∑–∞ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏
4.4.1. –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —É—Å–ª—É–≥ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —á–∞—Å—Ç–µ–π:
‚Ä¢ –ü—Ä—è–º—ã–µ —Ä–∞—Å—Ö–æ–¥—ã - —Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥ –ü–æ–¥—Ä—è–¥—á–∏–∫–æ–≤, —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω–∞—è –ó–∞–∫–∞–∑—á–∏–∫–æ–º –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ø. 4.2;
‚Ä¢ –ê–≥–µ–Ω—Ç—Å–∫–æ–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ - 20% –æ—Ç —Å—É–º–º—ã –ø—Ä—è–º—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤.
4.4.2. –û–ø–ª–∞—Ç–∞ –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —É—Å–ª—É–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –ó–∞–∫–∞–∑—á–∏–∫–æ–º –≤ —Ä–∞–∑–º–µ—Ä–µ 100% –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã –≤ —Ç–µ—á–µ–Ω–∏–µ 2 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π —Å –º–æ–º–µ–Ω—Ç–∞ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—á–µ—Ç–∞ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π.
4.4.3. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –æ–±—è–∑—É–µ—Ç—Å—è –ø–µ—Ä–µ—á–∏—Å–ª–∏—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞ –ü–æ–¥—Ä—è–¥—á–∏–∫–∞–º –≤ –ø–æ–ª–Ω–æ–º –æ–±—ä–µ–º–µ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∑–∞–∫–ª—é—á–µ–Ω–Ω—ã–º–∏ –¥–æ–≥–æ–≤–æ—Ä–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 3 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã –æ—Ç –ó–∞–∫–∞–∑—á–∏–∫–∞.
4.5. –í—Å–µ –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏ –ø–æ –∫–∞—á–µ—Å—Ç–≤—É –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —É—Å–ª—É–≥ –ó–∞–∫–∞–∑—á–∏–∫ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –ü–æ–¥—Ä—è–¥—á–∏–∫–∞–º. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–¥–µ–π—Å—Ç–≤–∏–µ –≤ —É—Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–ø–æ—Ä–æ–≤, –Ω–æ –Ω–µ –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –¥–µ–π—Å—Ç–≤–∏—è –ü–æ–¥—Ä—è–¥—á–∏–∫–æ–≤.
`;
        if (appState.printing) contractText += `‚Ä¢ –£—Å–ª—É–≥–∞ –ø–µ—á–∞—Ç–∏: ${printingCost} —Ä—É–±. (–ø—Ä—è–º—ã–µ —Ä–∞—Å—Ö–æ–¥—ã) + 20% –∞–≥–µ–Ω—Ç—Å–∫–æ–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ (${Math.round(printingCost * 0.2)} —Ä—É–±.) = ${Math.round(printingCost * 1.2)} —Ä—É–±. (–∏—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ)\n`;
        if (appState.painting) contractText += `‚Ä¢ –£—Å–ª—É–≥–∞ –ø–æ–∫—Ä–∞—Å–∫–∏: ${paintingCost} —Ä—É–±. (–ø—Ä—è–º—ã–µ —Ä–∞—Å—Ö–æ–¥—ã) + 20% –∞–≥–µ–Ω—Ç—Å–∫–æ–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ (${Math.round(paintingCost * 0.2)} —Ä—É–±.) = ${Math.round(paintingCost * 1.2)} —Ä—É–±. (–∏—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ)\n`;
    }
    contractText += `
5. –ò–°–ö–õ–Æ–ß–ò–¢–ï–õ–¨–ù–´–ï –ü–†–ê–í–ê
5.1. –ò—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–Ω—É—é 3D-–º–æ–¥–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –∫ –ó–∞–∫–∞–∑—á–∏–∫—É –≤ –ø–æ–ª–Ω–æ–º –æ–±—ä–µ–º–µ —Ç–æ–ª—å–∫–æ —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ–ª–Ω–æ–π –æ–ø–ª–∞—Ç—ã –≤—Å–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –î–æ–≥–æ–≤–æ—Ä–∞.
${appState.exclusive ? '5.2. –ó–∞–∫–∞–∑—á–∏–∫ –≤—ã–±—Ä–∞–ª –æ–ø—Ü–∏—é —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã—Ö –ø—Ä–∞–≤, —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–æ—Ç–æ—Ä–æ–π –≤–∫–ª—é—á–µ–Ω–∞ –≤ –æ–±—â—É—é —Ü–µ–Ω—É –î–æ–≥–æ–≤–æ—Ä–∞.\n' : ''}
6. –ó–ê–ö–õ–Æ–ß–ò–¢–ï–õ–¨–ù–´–ï –ü–û–õ–û–ñ–ï–ù–ò–Ø
6.1. –û–ø–ª–∞—Ç–∞ –≠—Ç–∞–ø–æ–≤ 1 –∏ 2 –æ–∑–Ω–∞—á–∞–µ—Ç –ø–æ–ª–Ω–æ–µ –∏ –±–µ–∑–æ–≥–æ–≤–æ—Ä–æ—á–Ω–æ–µ –ø—Ä–∏–Ω—è—Ç–∏–µ —É—Å–ª–æ–≤–∏–π –Ω–∞—Å—Ç–æ—è—â–µ–π –æ—Ñ–µ—Ä—Ç–∞ –∏ –¢–ó.
6.2. –°–ø–æ—Ä—ã —Ä–µ—à–∞—é—Ç—Å—è –ø—É—Ç–µ–º –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤, –∞ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Å–æ–≥–ª–∞—Å–∏—è ‚Äî –≤ —Å—É–¥–µ –ø–æ –º–µ—Å—Ç—É –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è.
–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:
–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω –°–µ—Ä–≥–µ–µ–≤–∏—á –°.
–ó–∞–∫–∞–∑—á–∏–∫:
${appState.customerName}
–ö–æ–Ω—Ç–∞–∫—Ç: ${appState.customerContact}
================================================================================
–¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –ó–ê–î–ê–ù–ò–ï (–¢–ó)
–∫ –î–æ–≥–æ–≤–æ—Ä—É –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ 3D-–º–æ–¥–µ–ª–∏
–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Ññ –¢–ó-${Date.now().toString().slice(-8)}
–ü—Ä–æ–µ–∫—Ç: ${projectName}
1. –¶–µ–ª—å –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
–î–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π 3D-–ø–µ—á–∞—Ç–∏ –∏ –∫–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.
2. –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚Ä¢ –†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã (—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏, —ç—Å–∫–∏–∑—ã), –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –ó–∞–∫–∞–∑—á–∏–∫–æ–º.
‚Ä¢ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ó–∞–∫–∞–∑—á–∏–∫–æ–º, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ —Ö–æ–¥–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è.
3. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –º–æ–¥–µ–ª–∏
–ò—Ç–æ–≥–æ–≤—ã–π —Ñ–∞–π–ª –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ .stl,
–í—ã—Å–æ—Ç–∞ –ú–æ–¥–µ–ª–∏ ${appState.height} —Å–º
4. –í–∏–∑—É–∞–ª—å–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ (–ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏)
–†–µ–∑—É–ª—å—Ç–∞—Ç —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –¢–ó –ø—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –ø–æ –æ–±—ä–µ–∫—Ç–∏–≤–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º.
‚Ä¢ –∞) –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ: –ú–æ–¥–µ–ª—å –æ–±–ª–∞–¥–∞–µ—Ç –∑–∞–º–∫–Ω—É—Ç–æ–π —Å–µ—Ç–∫–æ–π (manifold) –∏ –ø—Ä–∏–≥–æ–¥–Ω–∞ –¥–ª—è 3D-–ø–µ—á–∞—Ç–∏.
‚Ä¢ –±) –ö–æ–º–ø–æ–∑–∏—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ: –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏ –æ–±—â–∏–π —Å–∏–ª—É—ç—Ç –Ω–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–æ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é.
‚Ä¢ –≤) –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤—Å–µ –∫–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–∏–∑–∞–π–Ω–∞, –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ–º—ã–µ –Ω–∞ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–∞—Ö.
5. –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–∏–µ–º–∫–∏ —Ä–∞–±–æ—Ç—ã
‚Ä¢ –ü—Ä–∏–µ–º–∫–∞ –∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –∏ –µ–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —ç—Ç–∞–ø–æ–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ç–µ—á–µ–Ω–∏–∏ 48 —á–∞—Å–æ–≤ —Å –º–æ–º–µ–Ω—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –≥–æ—Ç–æ–≤–æ–π –º–æ–¥–µ–ª–∏
‚Ä¢ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–±–æ—Ç—ã –∏ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞ –Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ó–∞–∫–∞–∑—á–∏–∫—É —Å–æ–≥–ª–∞—Å–Ω–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Å–ø–æ—Å–æ–±—É (–º–µ—Å–µ–Ω–¥–∂–µ—Ä, email, —á–∞—Ç)
‚Ä¢ –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –æ—Ç–ø—Ä–∞–≤–∫—É –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –ª–µ–∂–∏—Ç –Ω–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ
‚Ä¢ –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –ª–µ–∂–∏—Ç –Ω–∞ –∑–∞–∫–∞–∑—á–∏–∫–µ
‚Ä¢ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—Ç–≤–µ—Ç–∞ –∏–ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ –ø–æ–¥–ª–µ–∂–∞—â–∏–π —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—é —è–≤–ª—è–µ—Ç—Å—è —Ñ–∞–∫—Ç–æ–º —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞–±–æ—Ç—ã
‚Ä¢ –§–∞–∫—Ç–æ–º —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —ç—Ç–∞–ø–æ–≤ –ø–µ—á–∞—Ç–∏ –∏ –ø–æ–∫—Ä–∞—Å–∫–∏ —è–≤–ª—è–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ –≥–æ—Ç–æ–≤–æ–≥–æ –∏–∑–¥–µ–ª–∏—è –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º
6. –£—Å–ª–æ–≤–∏—è –≤–Ω–µ—Å–µ–Ω–∏—è –ø—Ä–∞–≤–æ–∫
‚Ä¢ –ü—Ä–∞–≤–∫–∞ - —ç—Ç–æ –ª—é–±—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è –∑–∞–∫–∞–∑—á–∏–∫–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ —Å–æ–≥–ª–∞—Å–Ω–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º –ø—Ä–∏–µ–º–∫–∏
‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–º–µ—Ç–æ–∫ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –Ω–∞ –æ–¥–Ω–æ–º —Å–∫—Ä–∏–Ω—à–æ—Ç–µ –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ
‚Ä¢ –ù–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ —Ä–∞–±–æ—Ç—ã –≤–∫–ª—é—á–µ–Ω–∞ 1 –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –ø—Ä–∞–≤–∫–∞
‚Ä¢ –ü—Ä–∏–µ–º–∫–∞ –ø—Ä–∞–≤–∫–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ —Ç–µ–º –∂–µ —É—Å–ª–æ–≤–∏—è–º, —á—Ç–æ –∏ –ø—Ä–∏–µ–º–∫–∞ –º–æ–¥–µ–ª–∏
‚Ä¢ –ü—Ä–∞–≤–∫–∏ –∫ –ø—Ä–∏–Ω—è—Ç—ã–º —ç—Ç–∞–ø–∞–º –æ–ø–ª–∞—á–∏–≤–∞—é—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: 500 —Ä—É–±./ –ø–æ–¥—Ö–æ–¥
‚Ä¢ –ü—Ä–∞–≤–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ –≤–∏–¥–µ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ —Å –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º–∏ –ø–æ–º–µ—Ç–∫–∞–º–∏
‚Ä¢ –¢–µ–∫—Å—Ç–æ–≤—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è –±–µ–∑ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –ø–æ–º–µ—Ç–æ–∫ –Ω–µ –ø–æ–¥–ª–µ–∂–∞—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—é
‚Ä¢ –î–ª—è —É–¥–æ–±—Å—Ç–≤–∞, –∑–∞–∫–∞–∑—á–∏–∫—É –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω –¥–æ—Å—Ç—É–ø –∫ –æ–Ω–ª–∞–π–Ω –ø—Ä–æ—Å–º–æ—Ç—Ä—É –º–æ–¥–µ–ª–∏ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç—ã, –ø–æ–º–µ—Ç–∫–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–Ω–µ —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º —É—Å–ª–æ–≤–∏–µ–º)
–†–ê–ó–ë–ò–í–ö–ê –°–¢–û–ò–ú–û–°–¢–ò –ú–û–î–ï–õ–ò–†–û–í–ê–ù–ò–Ø:
‚Ä¢ –≠—Ç–∞–ø 1 (20%): ${stage1Cost} —Ä—É–±.
‚Ä¢ –≠—Ç–∞–ø 2 (30%): ${stage2Cost} —Ä—É–±.
‚Ä¢ –≠—Ç–∞–ø 3 (50%): ${stage3Cost} —Ä—É–±.
‚Ä¢ –ò–¢–û–ì–û: ${price} —Ä—É–±.
–î–ï–¢–ê–õ–ò –ó–ê–ö–ê–ó–ê:
‚Ä¢ –¢–∏–ø –º–æ–¥–µ–ª–∏: ${appState.projectType === 'individual' ? '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å –ø–æ —Ñ–æ—Ç–æ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ü–µ–Ω–∞)' : 
  category?.noDiscount ? '–ë—é–¥–∂–µ—Ç–Ω–∞—è –º–æ–¥–µ–ª—å –±–µ–∑ —Å–∫–∏–¥–∫–∏' : '–ì–æ—Ç–æ–≤–∞—è –º–æ–¥–µ–ª—å —Å –ª–∏—Ü–æ–º –ø–æ —Ñ–æ—Ç–æ (—Å–∫–∏–¥–∫–∞ 50%)'}
‚Ä¢ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${category?.name}
‚Ä¢ –ú–æ–¥–µ–ª—å: ${modelName}
‚Ä¢ –ü–æ–ª: ${appState.selectedGender === 'male' ? '–ú—É–∂—Å–∫–æ–π' : '–ñ–µ–Ω—Å–∫–∏–π'}
‚Ä¢ –í—ã—Å–æ—Ç–∞: ${appState.height} —Å–º
‚Ä¢ –°—Ä–æ–∫ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è: ${calculateFinalDays()} –¥–Ω–µ–π
‚Ä¢ –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –ø—Ä–∞–≤–∞: ${appState.exclusive ? '–î–ê' : '–ù–ï–¢'}
‚Ä¢ –ü–µ—á–∞—Ç—å –º–æ–¥–µ–ª–∏: ${appState.printing ? '–î–ê' : '–ù–ï–¢'}
‚Ä¢ –ü–æ–∫—Ä–∞—Å–∫–∞ –º–æ–¥–µ–ª–∏: ${appState.painting ? '–î–ê' : '–ù–ï–¢'}
‚Ä¢ –§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: ${appState.uploadedPhotos.length} —à—Ç.
‚Ä¢ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${appState.comment || '–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è'}
–î–∞—Ç–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è: ${day}.${now.getMonth() + 1}.${year} ${now.getHours()}:${now.getMinutes()}
`;
    return contractText;
}

function generateDetailedContract() {
    const price = calculatePrice();
    const now = new Date();
    document.getElementById('contractScreen').innerHTML = `
        <div class="contract-container">
            <div class="contract-header">
                <h1>–î–û–ì–û–í–û–†-–û–§–ï–†–¢–ê</h1>
                <h2>–°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞–∫–∞–∑!</h2>
            </div>
            <div class="project-info">
                <strong>–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞:</strong><br>
                ‚Ä¢ –¢–∏–ø: ${appState.projectType === 'individual' ? '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è' : '–ì–æ—Ç–æ–≤–∞—è'}<br>
                ‚Ä¢ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${appCategoriesConfig[appState.selectedGender]?.find(c => c.id === appState.selectedCategory)?.name || '‚Äî'}<br>
                ‚Ä¢ –ú–æ–¥–µ–ª—å: ${appState.projectType === 'individual' ? '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è' : getAvailableModels().find(m => m.id === appState.selectedModel)?.name || '‚Äî'}<br>
                ‚Ä¢ –ü–æ–ª: ${appState.selectedGender === 'male' ? '–ú—É–∂—Å–∫–æ–π' : '–ñ–µ–Ω—Å–∫–∏–π'}<br>
                ‚Ä¢ –í—ã—Å–æ—Ç–∞: ${appState.height} —Å–º<br>
                ‚Ä¢ –°—Ä–æ–∫: ${calculateFinalDays()} –¥–Ω–µ–π<br>
                ‚Ä¢ –°—Ç–æ–∏–º–æ—Å—Ç—å: ${price.toLocaleString()} —Ä—É–±.
            </div>
            <div style="text-align:center;margin-top:30px;">
                <p>–î–æ–≥–æ–≤–æ—Ä –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram.</p>
                <button class="btn" onclick="window.print()"><i class="fas fa-print"></i> –†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å</button>
                <button class="btn btn-secondary" onclick="location.reload()"><i class="fas fa-plus"></i> –ù–æ–≤—ã–π –∑–∞–∫–∞–∑</button>
            </div>
        </div>
    `;
    document.querySelector('.screen.active').classList.remove('active');
    document.getElementById('contractScreen').classList.add('active');
    updateProgressBar(6);
}

function updateProgressBar(step) {
    document.querySelectorAll('.progress-step').forEach((el, i) => {
        el.classList.toggle('active', i < step);
    });
}