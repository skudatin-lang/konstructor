<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Конструктор заказа 3D-модели</title>
    <style>
        /* ВСЕ ВАШИ СТИЛИ ОСТАЮТСЯ БЕЗ ИЗМЕНЕНИЙ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f7fa;
        }
        
        /* ... ВСЕ ОСТАЛЬНЫЕ СТИЛИ БЕЗ ИЗМЕНЕНИЙ ... */
        
        /* Добавим спиннер загрузки */
        .loading {
            text-align: center;
            padding: 40px;
            color: #3498db;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

<!-- Прогресс-бар -->
<div class="progress-bar" id="progressBar">
    <div class="progress-step active">
        <div class="step-circle">1</div>
        <div class="step-label">Тип модели</div>
    </div>
    <div class="progress-step">
        <div class="step-circle">2</div>
        <div class="step-label">Шаблон</div>
    </div>
    <div class="progress-step">
        <div class="step-circle">3</div>
        <div class="step-label">Настройка</div>
    </div>
    <div class="progress-step">
        <div class="step-circle">4</div>
        <div class="step-label">Заказ</div>
    </div>
</div>

<!-- Экран 1: Выбор типа модели -->
<div id="step1" class="screen active">
    <div class="screen-title">Выберите тип модели</div>
    
    <div class="project-type-container">
        <div class="project-type-card" onclick="selectProjectType('ready')">
            <div class="price-badge">скидка 50%</div>
            <h3>1. Готовая модель с лицом по фото</h3>
            <p>Выберите готовую модель из библиотеки и измените ей лицо в соответствии с вашим фото</p>
            <div class="photo-note">
                <i class="fas fa-exclamation-triangle"></i>
                <div>Требуется качественное фото в фас. При непригодном фото — возможны доработки за дополнительную плату.</div>
            </div>
        </div>
        
        <div class="project-type-card" onclick="selectProjectType('individual')">
            <div class="price-badge">стандартная цена</div>
            <h3>2. Индивидуальная модель по фото</h3>
            <p>Создайте свою индивидуальную модель в соответствии вашим фото</p>
            <div class="photo-note">
                <i class="fas fa-exclamation-triangle"></i>
                <div>Требуется чёткое фото в 3/4. При непригодном фото — возврат оплаты и расторжение договора.</div>
            </div>
        </div>
    </div>
    
    <div style="text-align: center; margin: 40px 0;">
        <button class="btn" onclick="nextStep(2)" id="next1" disabled>
            <i class="fas fa-cogs"></i> Настроить
        </button>
    </div>
</div>

<!-- Экран 2: Выбор шаблона -->
<div id="step2" class="screen">
    <div class="screen-title">Выберите подходящий шаблон модели</div>
    
    <div class="loading" id="loadingTemplates">
        <div class="spinner"></div>
        <p>Загрузка моделей...</p>
    </div>
    
    <div class="template-section">
        <h3>Мужские модели</h3>
        <div class="template-grid" id="maleTemplates"></div>
    </div>
    
    <div class="template-section">
        <h3>Женские модели</h3>
        <div class="template-grid" id="femaleTemplates"></div>
    </div>
    
    <div id="photoUploadSection" style="display: none;">
        <div class="photo-upload-section">
            <div class="photo-upload-box" onclick="document.getElementById('photoInput').click()">
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <div class="upload-text">
                    <strong>Загрузите фото для модели</strong>
                </div>
                <div class="upload-hint">
                    Нажмите или перетащите файл сюда<br>
                    Рекомендуется: JPG, PNG, до 5MB
                </div>
            </div>
            <input type="file" id="photoInput" accept="image/*" style="display: none;" onchange="handlePhotoUpload(event)">
            <div id="photoPreview" class="photo-preview"></div>
        </div>
    </div>
    
    <div style="text-align: center; margin: 40px 0;">
        <button class="btn btn-secondary" onclick="prevStep(1)">
            <i class="fas fa-arrow-left"></i> Назад
        </button>
        <button class="btn" onclick="nextStep(3)" id="next2" disabled>
            <i class="fas fa-sliders-h"></i> Настроить проект
        </button>
    </div>
</div>

<!-- Экран 3: Настройка проекта -->
<div id="step3" class="screen">
    <!-- ... ВАШ ЭКРАН 3 БЕЗ ИЗМЕНЕНИЙ ... -->
</div>

<!-- Экран 4: Оформление заказа -->
<div id="step4" class="screen">
    <!-- ... ВАШ ЭКРАН 4 БЕЗ ИЗМЕНЕНИЙ ... -->
</div>

<!-- Экран 5: Договор -->
<div id="contractScreen" class="screen"></div>

<script>
    // === ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ ===
    let state = {
        projectType: null,
        selectedTemplate: null,
        uploadedPhoto: null,
        height: '15',
        baseDays: '14',
        exclusive: false,
        printing: false,
        painting: false,
        customerName: '',
        customerContact: '',
        comment: ''
    };

    // === ВСТРОЕННЫЕ ШАБЛОНЫ (если JSON не загрузится) ===
    const BUILT_IN_TEMPLATES = [
        // Мужские модели
        {
            id: 'full_neutral_man',
            name: 'Мужчина полный рост, нейтральный стиль', 
            price: 9100,
            type: 'full', 
            gender: 'male',
            imageUrl: 'https://drive.google.com/thumbnail?id=1Ar0QgR-prDCPzE-xDoneLIHvnMQH77aN&sz=w1000',
            availableFor: ['ready', 'individual']
        },
        {
            id: 'full_business_man',
            name: 'Мужчина полный рост, деловой стиль', 
            price: 9100,
            type: 'full', 
            gender: 'male',
            imageUrl: 'https://drive.google.com/thumbnail?id=1CVhANoz6tRhnFwK0rf5Opv5jdzQj4qT3&sz=w1000',
            availableFor: ['ready', 'individual']
        },
        {
            id: 'mini_free_man',
            name: 'Мужчина мини фигурка, свободный стиль', 
            price: 9100,
            type: 'mini', 
            gender: 'male',
            imageUrl: 'https://drive.google.com/thumbnail?id=1ZLk00m_viSvxehM-Q-kFlcU2B4xnDfAX&sz=w1000',
            availableFor: ['ready', 'individual']
        },
        {
            id: 'mini_business_man',
            name: 'Мужчина мини фигурка, деловой стиль', 
            price: 9100,
            type: 'mini', 
            gender: 'male',
            imageUrl: 'https://drive.google.com/thumbnail?id=18HVz_-tkG6vJBGtGXIkFu4JBnRekDkL5&sz=w1000',
            availableFor: ['ready', 'individual']
        },
        {
            id: 'bust_modern_man',
            name: 'Мужчина бюст модерн', 
            price: 6300, 
            type: 'bust', 
            gender: 'male',
            imageUrl: 'https://drive.google.com/thumbnail?id=1l5GFi7U-4-M2djgb8nSQeL9Uvkienlgj&sz=w1000',
            availableFor: ['ready', 'individual']
        },
        {
            id: 'bust_classic_man',
            name: 'Мужчина бюст классика', 
            price: 6300, 
            type: 'bust', 
            gender: 'male',
            imageUrl: 'https://drive.google.com/thumbnail?id=1tS0bNd4lP7u_wmrZL5yJVMELGkGlhq78&sz=w1000',
            availableFor: ['ready', 'individual']
        },
        {
            id: 'bust_head_man',
            name: 'Мужчина бюст голова', 
            price: 4200, 
            type: 'bust_head', 
            gender: 'male',
            imageUrl: 'https://drive.google.com/thumbnail?id=1qEFkgFPEX1eZHyVKxiobdEPtuQvW3WhD&sz=w1000',
            availableFor: ['ready']
        },
        
        // Женские модели
        {
            id: 'full_neutral_woman',
            name: 'Девушка полный рост, нейтральный стиль', 
            price: 9100, 
            type: 'full', 
            gender: 'female',
            imageUrl: 'https://drive.google.com/thumbnail?id=1QWtuqbRj8R6WuCMiqh6Y-k7z8SD_gyqw&sz=w1000',
            availableFor: ['ready', 'individual']
        },
        {
            id: 'full_business_woman',
            name: 'Девушка полный рост, деловой стиль', 
            price: 9100, 
            type: 'full', 
            gender: 'female',
            imageUrl: 'https://drive.google.com/thumbnail?id=1WWWusHzpLJErrQwRL6dC1mT8mOZa6y-_&sz=w1000',
            availableFor: ['ready', 'individual']
        },
        {
            id: 'mini_free_woman',
            name: 'Девушка мини фигурка, свободный стиль', 
            price: 9100, 
            type: 'mini', 
            gender: 'female',
            imageUrl: 'https://drive.google.com/thumbnail?id=1S8VMcrxyMGximaOimkHODn_lNfKzG1c-&sz=w1000',
            availableFor: ['ready', 'individual']
        },
        {
            id: 'mini_business_woman',
            name: 'Девушка мини фигурка, деловой стиль', 
            price: 9100, 
            type: 'mini', 
            gender: 'female',
            imageUrl: 'https://drive.google.com/thumbnail?id=1M-jxV5gHearmahCp8Bzlo6nPYElGTb3I&sz=w1000',
            availableFor: ['ready', 'individual']
        },
        {
            id: 'bust_modern_woman',
            name: 'Девушка бюст модерн', 
            price: 7000, 
            type: 'bust', 
            gender: 'female',
            imageUrl: 'https://drive.google.com/thumbnail?id=1L-RHTWzyadKC3tl5WFsraczH-A3USW7U&sz=w1000',
            availableFor: ['ready', 'individual']
        },
        {
            id: 'bust_classic_woman',
            name: 'Девушка бюст классика', 
            price: 7000, 
            type: 'bust', 
            gender: 'female',
            imageUrl: 'https://drive.google.com/thumbnail?id=1CAv63ANI2LGqbVvcoek2-cEM9J2dCl5v&sz=w1000',
            availableFor: ['ready', 'individual']
        },
        {
            id: 'bust_head_woman',
            name: 'Девушка бюст голова', 
            price: 4200, 
            type: 'bust_head', 
            gender: 'female',
            imageUrl: 'https://drive.google.com/thumbnail?id=1JlZEGsBsl8I0HTgWXfaW4RvSAVR0ccZE&sz=w1000',
            availableFor: ['ready']
        }
    ];

    // === НАСТРОЙКИ TELEGRAM ===
    const TELEGRAM_BOT_TOKEN = '7995086363:AAHAonpRf69e1avVPq9_rJqToTsuPRSxnf4';
    const TELEGRAM_CHANNEL_ID = '-1003314026322';

    // === ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ ===
    function showNotification(message, isError = false, isWarning = false) {
        const notification = document.createElement('div');
        notification.className = `notification ${isError ? 'error' : isWarning ? 'warning' : ''}`;
        notification.innerHTML = `
            <i class="fas fa-${isError ? 'exclamation-circle' : isWarning ? 'exclamation-triangle' : 'check-circle'}"></i>
            <span>${message}</span>
        `;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.remove();
        }, 5000);
    }

    function updateProgressBar(step) {
        const steps = document.querySelectorAll('.progress-step');
        steps.forEach((stepEl, index) => {
            stepEl.classList.toggle('active', index < step);
        });
    }

    // === ФУНКЦИИ ДЛЯ РАБОТЫ С ШАБЛОНАМИ ===
    async function loadTemplates() {
        try {
            // Пробуем загрузить из JSON файла
            const response = await fetch('templates.json');
            if (!response.ok) throw new Error('JSON файл не найден');
            
            const data = await response.json();
            return data.templates || BUILT_IN_TEMPLATES;
        } catch (error) {
            console.log('Используем встроенные шаблоны:', error.message);
            return BUILT_IN_TEMPLATES;
        }
    }

    async function renderTemplates() {
        const maleGrid = document.getElementById('maleTemplates');
        const femaleGrid = document.getElementById('femaleTemplates');
        const loadingDiv = document.getElementById('loadingTemplates');
        
        maleGrid.innerHTML = '';
        femaleGrid.innerHTML = '';
        
        if (!state.projectType) {
            loadingDiv.style.display = 'none';
            maleGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #7f8c8d;">Выберите тип модели на первом шаге</div>';
            return;
        }
        
        // Показываем спиннер
        loadingDiv.style.display = 'block';
        
        // Загружаем шаблоны
        const allTemplates = await loadTemplates();
        
        // Скрываем спиннер
        loadingDiv.style.display = 'none';
        
        if (allTemplates.length === 0) {
            maleGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #e74c3c;">Нет доступных моделей</div>';
            return;
        }
        
        // Фильтруем по доступности
        const availableTemplates = allTemplates.filter(template => 
            template.availableFor.includes(state.projectType)
        );
        
        // Разделяем по полу
        const maleTemplates = availableTemplates.filter(t => t.gender === 'male');
        const femaleTemplates = availableTemplates.filter(t => t.gender === 'female');
        
        // Рендерим мужские модели
        maleTemplates.forEach(template => {
            maleGrid.appendChild(createTemplateCard(template));
        });
        
        // Рендерим женские модели
        femaleTemplates.forEach(template => {
            femaleGrid.appendChild(createTemplateCard(template));
        });
        
        // Если нет моделей в категории
        if (maleTemplates.length === 0) {
            maleGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 20px; color: #7f8c8d;">Нет доступных мужских моделей</div>';
        }
        
        if (femaleTemplates.length === 0) {
            femaleGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 20px; color: #7f8c8d;">Нет доступных женских моделей</div>';
        }
    }

    function createTemplateCard(template) {
        const displayPrice = state.projectType === 'ready' ? 
            Math.round(template.price * 0.5) : template.price;
        
        const div = document.createElement('div');
        div.className = 'template-card';
        div.innerHTML = `
            <div class="template-image ${template.gender}">
                <img src="${template.imageUrl}" 
                     alt="${template.name}"
                     loading="lazy"
                     onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMDAiIGZpbGw9IiM2NjdFRUEiLz48dGV4dCB4PSI1MCIgeT0iNTAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIwLjNlbSI+PHQgc3BhbiB4PSI1MCIgeT0iNTAiPjNEIE1PREVMPC90c3Bhbj48L3RleHQ+PC9zdmc+'">
            </div>
            <div class="template-info">
                <div class="template-name">${template.name}</div>
                <div class="template-price">
                    ${state.projectType === 'ready' ? 
                        `<span class="original">${template.price} руб</span>` : ''}
                    ${displayPrice} руб
                </div>
                <div class="template-type">
                    ${getTypeName(template.type)}
                </div>
            </div>
        `;
        
        div.onclick = () => {
            document.querySelectorAll('.template-card').forEach(el => el.classList.remove('selected'));
            div.classList.add('selected');
            state.selectedTemplate = template.id;
            document.getElementById('next2').disabled = false;
            
            document.getElementById('photoUploadSection').style.display = 'block';
            updateHeightOptions(template.type);
        };
        
        return div;
    }

    function getTypeName(type) {
        const typeNames = {
            'bust': 'Бюст',
            'bust_head': 'Бюст голова',
            'mini': 'Мини',
            'full': 'Полная фигура'
        };
        return typeNames[type] || type;
    }

    // === ВАШИ СТАРЫЕ ФУНКЦИИ (ОСТАВЬТЕ ИХ БЕЗ ИЗМЕНЕНИЙ) ===
    
    function selectProjectType(type) {
        state.projectType = type;
        document.querySelectorAll('.project-type-card').forEach(el => el.classList.remove('selected'));
        event.currentTarget.classList.add('selected');
        document.getElementById('next1').disabled = false;
    }

    function handlePhotoUpload(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        if (!file.type.match('image.*')) {
            alert('Пожалуйста, загрузите изображение');
            return;
        }
        
        if (file.size > 5 * 1024 * 1024) {
            alert('Файл слишком большой. Максимальный размер: 5MB');
            return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
            state.uploadedPhoto = e.target.result;
            const preview = document.getElementById('photoPreview');
            preview.innerHTML = `
                <div style="margin-bottom: 15px; color: #2ecc71; font-weight: 600;">
                    <i class="fas fa-check-circle"></i> Фото успешно загружено
                </div>
                <img src="${e.target.result}" class="preview-image" alt="Загруженное фото">
                <div style="margin-top: 10px;">
                    <button class="btn-secondary" onclick="removePhoto()" style="padding: 8px 16px; font-size: 14px;">
                        <i class="fas fa-trash"></i> Удалить фото
                    </button>
                </div>
            `;
        };
        reader.readAsDataURL(file);
    }

    function removePhoto() {
        state.uploadedPhoto = null;
        document.getElementById('photoInput').value = '';
        document.getElementById('photoPreview').innerHTML = '';
    }

    function setupConfigOptions() {
        // Высота
        document.querySelectorAll('#heightGroup .option-btn').forEach(btn => {
            btn.onclick = () => {
                if (btn.classList.contains('disabled')) return;
                document.querySelectorAll('#heightGroup .option-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                state.height = btn.dataset.value;
                updatePrice();
            };
        });
        
        // Сроки
        document.querySelectorAll('#daysGroup .option-btn').forEach(btn => {
            btn.onclick = () => {
                document.querySelectorAll('#daysGroup .option-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                state.baseDays = btn.dataset.value;
                updatePrice();
            };
            if (btn.dataset.value === state.baseDays) btn.classList.add('active');
        });
        
        // Устанавливаем активную высоту
        document.querySelector(`#heightGroup .option-btn[data-value="${state.height}"]`).classList.add('active');
    }

    function updateHeightOptions(modelType) {
        const isBust = modelType === 'bust' || modelType === 'bust_head' || modelType === 'mini';
        const heightGroup = document.getElementById('heightGroup');
        const buttons = heightGroup.querySelectorAll('.option-btn');
        
        buttons.forEach(btn => {
            const h = btn.dataset.value;
            if (isBust && (h === '20' || h === '25')) {
                btn.classList.add('disabled');
                if (btn.classList.contains('active')) {
                    btn.classList.remove('active');
                    state.height = '18';
                    document.querySelector(`#heightGroup .option-btn[data-value="18"]`).classList.add('active');
                }
            } else {
                btn.classList.remove('disabled');
            }
        });
        updatePrice();
    }

    function toggleExclusive(checked) {
        state.exclusive = checked;
        updatePrice();
    }

    function togglePrinting(checked) {
        state.printing = checked;
        const paintingToggle = document.getElementById('paintingToggle');
        
        if (checked) {
            paintingToggle.disabled = false;
            document.getElementById('printingPrice').style.display = 'block';
        } else {
            paintingToggle.disabled = true;
            paintingToggle.checked = false;
            state.painting = false;
            document.getElementById('printingPrice').style.display = 'none';
            document.getElementById('paintingPrice').style.display = 'none';
        }
        updatePrice();
    }

    function togglePainting(checked) {
        state.painting = checked;
        if (checked) {
            document.getElementById('paintingPrice').style.display = 'block';
        } else {
            document.getElementById('paintingPrice').style.display = 'none';
        }
        updatePrice();
    }

    // Расчет стоимости
    function calculatePrice() {
        // Находим выбранный шаблон в BUILT_IN_TEMPLATES
        const template = BUILT_IN_TEMPLATES.find(t => t.id === state.selectedTemplate);
        if (!template) return null;
        
        let base = template.price;
        
        // Готовая модель со скидкой 50% от базовой цены
        if (state.projectType === 'ready') base = Math.round(base * 0.5);
        // Индивидуальная модель - базовая цена
        
        let total = base;

        // Надбавка за высоту
        if (['15', '18'].includes(state.height)) total = Math.round(total * 1.15);
        else if (['20', '25'].includes(state.height)) total = Math.round(total * 1.25);

        // Надбавка за сжатые сроки
        if (state.baseDays === '7') total = Math.round(total * 1.1);
        else if (state.baseDays === '3') total = Math.round(total * 1.2);

        // Эксклюзивные права
        if (state.exclusive) total = Math.round(total * 1.6);

        // Печать
        let printingCost = 0;
        if (state.printing) {
            if (state.height === '10') printingCost = 2500;
            else if (['15', '18'].includes(state.height)) printingCost = 4000;
            else printingCost = 5500;
            total += printingCost;
            document.getElementById('printingCost').textContent = printingCost;
        }

        // Покраска
        let paintingCost = 0;
        if (state.painting) {
            if (state.height === '10') paintingCost = 7000;
            else if (['15', '18'].includes(state.height)) paintingCost = 10000;
            else paintingCost = 12000;
            total += paintingCost;
            document.getElementById('paintingCost').textContent = paintingCost;
        }

        return total;
    }

    function calculateFinalDays() {
        let days = parseInt(state.baseDays);
        if (state.printing) days += 14;
        if (state.painting) days += 14;
        return days;
    }

    function updatePrice() {
        const price = calculatePrice();
        const finalDays = calculateFinalDays();
        
        if (price !== null) {
            document.getElementById('totalPrice').textContent = price.toLocaleString();
            document.getElementById('finalDays').textContent = finalDays;
        }
    }

    // Навигация
    function nextStep(step) {
        document.querySelector('.screen.active').classList.remove('active');
        document.getElementById(`step${step}`).classList.add('active');
        updateProgressBar(step);
        
        if (step === 2) renderTemplates();
        if (step === 4) updateSummary();
    }
    
    function prevStep(step) {
        document.querySelector('.screen.active').classList.remove('active');
        document.getElementById(`step${step}`).classList.add('active');
        updateProgressBar(step - 1);
    }

    // Обновление сводки
    function updateSummary() {
        const price = calculatePrice();
        const finalDays = calculateFinalDays();
        
        if (price === null) return;
        
        const typeName = state.projectType === 'individual' ? 
            'Индивидуальная модель по фото (стандартная цена)' : 
            'Готовая модель с лицом по фото (скидка 50%)';
        
        const template = BUILT_IN_TEMPLATES.find(t => t.id === state.selectedTemplate);
        
        document.getElementById('sumType').textContent = typeName;
        document.getElementById('sumTemplate').textContent = template?.name || '—';
        document.getElementById('sumHeight').textContent = state.height;
        document.getElementById('sumFinalDays').textContent = finalDays;
        document.getElementById('sumExcl').textContent = state.exclusive ? 'ДА' : 'НЕТ';
        document.getElementById('sumPrint').textContent = state.printing ? 'ДА' : 'НЕТ';
        document.getElementById('sumPaint').textContent = state.painting ? 'ДА' : 'НЕТ';
        document.getElementById('sumPrice').textContent = price.toLocaleString();
    }

    // === ОСТАЛЬНЫЕ ФУНКЦИИ (submitOrder, sendOrderToTelegram и т.д.) ===
    // ВСТАВЬТЕ СЮДА ВСЕ ОСТАВШИЕСЯ ФУНКЦИИ ИЗ ВАШЕГО ИСХОДНОГО КОДА
    // начиная с функции submitOrder() и до конца
    
    // Главная функция оформления заказа
    async function submitOrder() {
        // ВАШ КОД submitOrder() БЕЗ ИЗМЕНЕНИЙ
    }

    // Отправка уведомления о заказе в Telegram канал
    async function sendOrderToTelegram() {
        // ВАШ КОД sendOrderToTelegram() БЕЗ ИЗМЕНЕНИЙ
    }

    // Отправка договора в Telegram канал (в виде файла)
    async function sendContractToTelegram() {
        // ВАШ КОД sendContractToTelegram() БЕЗ ИЗМЕНЕНИЙ
    }

    // Отправка договора текстом (если не удалось отправить файлом)
    async function sendContractAsText(contractText) {
        // ВАШ КОД sendContractAsText() БЕЗ ИЗМЕНЕНИЙ
    }

    // Вспомогательные функции для договора
    function getMonthName(month) {
        const months = [
            'января', 'февраля', 'марта', 'апреля', 'мая', 'июня',
            'июля', 'августа', 'сентября', 'октября', 'ноября', 'декабря'
        ];
        return months[month];
    }

    function numberToWords(number) {
        const units = ['', 'один', 'два', 'три', 'четыре', 'пять', 'шесть', 'семь', 'восемь', 'девять'];
        const teens = ['десять', 'одиннадцать', 'двенадцать', 'тринадцать', 'четырнадцать', 'пятнадцать', 
                      'шестнадцать', 'семнадцать', 'восемнадцать', 'девятнадцать'];
        const tens = ['', '', 'двадцать', 'тридцать', 'сорок', 'пятьдесят', 'шестьдесят', 'семьдесят', 'восемьдесят', 'девяносто'];
        const hundreds = ['', 'сто', 'двести', 'триста', 'четыреста', 'пятьсот', 'шестьсот', 'семьсот', 'восемьсот', 'девятьсот'];
        
        let num = parseInt(number);
        if (isNaN(num) || num <= 0) return 'ноль';
        
        let result = '';
        
        // Тысячи
        if (num >= 1000) {
            const thousands = Math.floor(num / 1000);
            if (thousands === 1) {
                result += 'одна тысяча ';
            } else if (thousands >= 2 && thousands <= 4) {
                result += numberToWords(thousands) + ' тысячи ';
            } else {
                result += numberToWords(thousands) + ' тысяч ';
            }
            num %= 1000;
        }
        
        // Сотни
        if (num >= 100) {
            result += hundreds[Math.floor(num / 100)] + ' ';
            num %= 100;
        }
        
        // Десятки и единицы
        if (num >= 20) {
            result += tens[Math.floor(num / 10)] + ' ';
            num %= 10;
        } else if (num >= 10) {
            result += teens[num - 10] + ' ';
            num = 0;
        }
        
        // Единицы
        if (num > 0) {
            result += units[num] + ' ';
        }
        
        return result.trim();
    }

    // Генерация текста договора для отправки
    function generateContractText() {
        // ВАШ КОД generateContractText() БЕЗ ИЗМЕНЕНИЙ
        // Только замените templatesConfig[state.selectedTemplate] на:
        // const template = BUILT_IN_TEMPLATES.find(t => t.id === state.selectedTemplate);
    }

    // Генерация HTML договора для отображения пользователю
    function generateDetailedContract() {
        // ВАШ КОД generateDetailedContract() БЕЗ ИЗМЕНЕНИЙ
        // Только замените templatesConfig[state.selectedTemplate] на:
        // const template = BUILT_IN_TEMPLATES.find(t => t.id === state.selectedTemplate);
    }

    // Поделиться договором как текст
    function shareContractAsText() {
        const contractText = generateContractText();
        navigator.clipboard.writeText(contractText)
            .then(() => showNotification('Текст договора скопирован в буфер обмена'))
            .catch(() => {
                // Fallback
                const textArea = document.createElement('textarea');
                textArea.value = contractText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('Текст договора скопирован в буфер обмена');
            });
    }

    // === ИНИЦИАЛИЗАЦИЯ ===
    document.addEventListener('DOMContentLoaded', function() {
        setupConfigOptions();
        // Скрываем спиннер при загрузке
        document.getElementById('loadingTemplates').style.display = 'none';
    });
</script>
</body>
</html>