<!-- Подключаем новые модули -->
<script src="telegram-service.js"></script>
<script src="contract-generator.js"></script>

<script>
// В основном файле оставляем только:
async function submitOrder() {
    // ... валидация ...
    
    const orderData = {
        state,
        categoriesConfig,
        modelsConfig
    };
    
    try {
        // 1. Отправляем заказ в Telegram через сервис
        await TelegramService.sendOrder(orderData);
        
        // 2. Генерируем договор
        const contractText = ContractGenerator.generate(orderData);
        
        // 3. Отправляем договор в Telegram
        await TelegramService.sendContract(
            contractText,
            state.customerName,
            state.customerContact,
            TelegramService.calculatePrice(state, categoriesConfig)
        );
        
        // 4. Показываем договор пользователю
        generateDetailedContract(contractText);
        
        showNotification('Заказ успешно оформлен! Договор создан и отправлен.');
        
    } catch (error) {
        console.error('Ошибка:', error);
        showNotification('Ошибка при оформлении заказа', true);
        generateDetailedContract(ContractGenerator.generate(orderData));
    }
}

// Обновленная функция для копирования договора
function shareContractAsText() {
    const orderData = { state, categoriesConfig, modelsConfig };
    const contractText = ContractGenerator.generate(orderData);
    
    navigator.clipboard.writeText(contractText)
        .then(() => showNotification('Текст договора скопирован в буфер обмена'))
        .catch(() => {
            // Fallback
            const textArea = document.createElement('textarea');
            textArea.value = contractText;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            showNotification('Текст договора скопирован в буфер обмена');
        });
}
</script>